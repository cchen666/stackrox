tests:
  - name: "cluster name secret is created on installation"
    Release:
      IsInstall: true
    Condition:
      IfFlavour: chart
    values:
      clusterName: test
    expect: |
      .secrets["helm-effective-cluster-name"] | assertThat(. != null)
      (container(.deployments.sensor; "sensor")).volumeMounts[] | select(.name == "helm-effective-cluster-name") | assertThat(. != null)
      .deployments.sensor.spec.template.spec.volumes[] | select(.name == "helm-effective-cluster-name") | assertThat(. != null)
  - name: "cluster name secret is created on installation"
    Release:
      IsInstall: true
    Condition:
      IfFlavour: bundle
    values:
      cluster:
        name: test
    expect: |
      .secrets["helm-effective-cluster-name"] | assertThat(. != null)
